<dom-module id="ui-button">
    <link rel="import" href="../behaviors/behaviors.html">
    <link rel="import" href="../progress/circular.html">
    <link rel="import" type="css" href="button.css">

    <template>
        <ui-button-frame>
            <ui-button-content>
                <content></content>
            </ui-button-content>
        </ui-button-frame>

        <ui-progress-circular></ui-progress-circular>
    </template>

    <script>
        Polymer({
            is: 'ui-button',
            behaviors: [ Lime.Behaviors.Focusable ],

            properties: {
                primary: {
                    type: Boolean,
                    value: false
                },

                secondary: {
                    type: Boolean,
                    value: true
                },

                pressed: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                progress: {
                    type: Number,
                    value: 0,
                    reflectToAttribute: true,
                    observer: '_progressChange'
                }
            },

            listeners: {
                down: '_onDown',
                up: '_onUp'
            },

            // Event listeners

            _onDown: function() {
                this.pressed = true;
            },

            _onUp: function() {
                this.pressed = false;
                //this.loading = !this.loading;
            },

            // Change listeners
            _progressChange: function(value, oldvalue) {
                var circular = this.$$('ui-progress-circular');


                // SHOULD BE DONE BY PROGRESS EVENTS
                if(value === 0 || (oldvalue < 100 && value >= 100)) {
                    circular.reset();
                    this.classList.remove('ui-progress-state');
                } else {
                    this.classList.add('ui-progress-state');
                    circular.setProgress(value, 100);
                }
            }
        });
    </script>
</dom-module>